# StockAI - AI-Powered Stock Prediction Platform

## Project Overview
This is a full-stack stock prediction and backtesting platform using AI (LSTM neural networks) to predict stock prices and compare predictions with actual results.

## Tech Stack
- **Frontend**: React 18, Tailwind CSS, React Router v6, Axios
- **Backend**: Node.js + Express (port 5001)
- **Database**: MongoDB (optional - works without it in demo mode)
- **ML Engine**: Python + TensorFlow/Keras (called by Node.js backend)
- **Authentication**: JWT (optional)

## Project Structure

```
FYP-draft/
├── backend-node/              # Node.js Express API
│   ├── models/               # MongoDB user model
│   ├── routes/               # API routes (auth)
│   ├── middleware/           # JWT auth middleware
│   └── server.js             # Main backend server
├── frontend/                 # React application
│   ├── src/
│   │   ├── components/       # React components
│   │   │   └── Auth/        # Login, Signup
│   │   ├── pages/           # Dashboard
│   │   ├── services/        # API client, auth service
│   │   └── App.js           # Router setup
│   └── package.json
├── models/                   # Pre-trained AI models (10 .keras files)
├── model.py                 # Python ML training script
├── combined_data.csv        # Historical stock data
├── .env                     # Environment variables (user creates)
└── start.sh / start.bat     # Startup scripts

```

## Key Features
1. **Step-by-step UI Flow**: Year → Amount → Period → Results
2. **AI Predictions**: Analyzes 10 major Indian stocks
3. **Backtesting**: Compares predictions vs actual results
4. **Authentication**: Optional MongoDB auth (works without it)
5. **Beautiful Animations**: Smooth transitions, loading states

## Available Stocks (10)
- HDFCBANK.NS, ICICIBANK.NS, SBIN.NS (Banking)
- RELIANCE.NS (Conglomerate)
- TCS.NS, INFY.NS (IT Services)
- HINDUNILVR.NS, ITC.NS (FMCG)
- BHARTIARTL.NS (Telecom)
- LICI.NS (Insurance)

## Coding Guidelines

### General Rules
- Use ES6+ syntax
- Keep functions small and focused
- Write descriptive variable names
- Add comments for complex logic
- Handle errors gracefully with try-catch
- Use async/await for asynchronous operations

### Frontend (React)
- **Components**: Functional components with hooks
- **State Management**: useState, useEffect
- **Styling**: Tailwind CSS classes only (no custom CSS except animations)
- **API Calls**: Use apiService from services/api.js
- **Authentication**: Use authService from services/authService.js
- **Routing**: React Router v6 with Navigate
- **Date Format**: YYYY-MM-DD (use formatDate function)
- **Animations**: 
  - Transitions: 300-500ms duration
  - Scale on hover: 1.05x
  - Fade in/out: opacity + translateY
- **Colors**:
  - Primary: Blue (blue-500 to blue-600)
  - Secondary: Indigo (indigo-500 to indigo-600)
  - Success: Green (green-500 to emerald-600)
  - Error: Red (red-500 to red-600)
  - Background: Light gray-blue gradient

### Backend (Node.js)
- **Port**: 5001
- **CORS**: Enabled for all origins (development)
- **MongoDB**: Optional - falls back to demo mode if not connected
- **Auth Middleware**: protect() - allows access without MongoDB
- **Error Handling**: Return proper HTTP status codes
- **Python Integration**: Use child_process.spawn to call Python scripts
- **Timeouts**: 5 seconds for MongoDB queries, 45 seconds for socket
- **Environment**: Load from .env using dotenv

### Python (ML Engine)
- **Models**: Pre-trained LSTM models in models/ folder
- **Input**: 60-day lookback window
- **Output**: 30-day ahead prediction
- **Data**: Load from combined_data.csv
- **Scalers**: MinMaxScaler for normalization
- **Format**: JSON output for Node.js consumption

## API Endpoints

### Authentication (Optional)
- POST `/api/auth/signup` - Create account
- POST `/api/auth/login` - User login
- GET `/api/auth/me` - Get current user (protected)

### Stock Predictions (Protected*)
- GET `/api/health` - System health check
- GET `/api/available-years` - Get years (2015-2024)
- POST `/api/recommend` - Get stock recommendation
- POST `/api/backtest` - Get backtest results

*Protected = requires JWT token if MongoDB is connected, otherwise open access

## Environment Variables (.env)

```env
# MongoDB (optional)
MONGODB_URI=mongodb+srv://user:pass@cluster.mongodb.net/stockai

# JWT Secret
JWT_SECRET=your_secure_random_string_here

# Server
PORT=5001
NODE_ENV=development

# Frontend
FRONTEND_URL=http://localhost:3000
```

## Important Business Logic

### Stock Recommendation Flow
1. User selects: year, amount, holding period
2. Backend loads 10 pre-trained models
3. For each stock:
   - Load historical data up to selected date
   - Create 60-day sequence
   - Normalize data
   - Run through LSTM model
   - Get predicted price
   - Calculate expected return
4. Sort by expected return
5. Return best stock
6. Calculate max stocks to buy with budget
7. Get actual price at end date for backtesting

### Date Filtering
- **Available years**: 2015-2024 only (2014 removed)
- **Date format**: YYYY-MM-DD everywhere
- **Timezone**: Always use timezone-naive dates

### Investment Calculation
```
num_stocks = floor(investment_amount / current_price)
actual_investment = num_stocks * current_price
remaining_cash = investment_amount - actual_investment
```

### Accuracy Calculation
```
price_error = abs(predicted_price - actual_price)
price_accuracy = 100 - ((price_error / actual_price) * 100)
direction_correct = (predicted > current) == (actual > current)
```

## MongoDB Integration

### With MongoDB:
- User authentication required
- JWT tokens for API access
- User sessions stored

### Without MongoDB:
- Demo mode activated
- All endpoints accessible
- Guest user created automatically
- No authentication required

## Error Handling

### Frontend
- Show user-friendly error messages
- Red bordered cards for errors
- Shake animation on error
- Allow retry

### Backend
- Return appropriate HTTP codes:
  - 200: Success
  - 400: Bad request
  - 401: Unauthorized
  - 403: Forbidden
  - 500: Server error
  - 503: Service unavailable (MongoDB down)
- Include helpful error messages
- Log errors to console

## Performance Considerations

### Model Loading
- Lazy loading: Load models on first prediction request
- Cache loaded models in memory
- Timeout: 5 seconds for MongoDB, 45 seconds for Python

### Frontend Optimization
- Lazy load components with React.lazy (if needed)
- Debounce user inputs
- Show loading states
- Disable buttons during processing

## Testing Checklist

Before deploying changes:
- [ ] Frontend compiles without errors
- [ ] Backend starts on port 5001
- [ ] All 4 steps of flow work
- [ ] Year selection (no 2014)
- [ ] Investment amount input
- [ ] Holding period calculation
- [ ] Results display with backtesting
- [ ] Date format is YYYY-MM-DD
- [ ] Animations smooth
- [ ] Error handling works
- [ ] Works without MongoDB

## Common Tasks

### Add New Stock
1. Get historical data CSV
2. Add to combined_data.csv
3. Train model: `python3 model.py`
4. Model saved to models/{TICKER}.keras

### Modify UI
1. Edit frontend/src/pages/Dashboard.js
2. Use Tailwind classes only
3. Maintain step-by-step flow
4. Test animations

### Update API
1. Edit backend-node/server.js or routes/
2. Maintain CORS settings
3. Handle MongoDB optional
4. Return JSON responses

### Fix MongoDB Issues
1. Check MONGODB_URI in .env
2. Verify connection string format
3. Check IP whitelist (0.0.0.0/0 for dev)
4. System works without it (demo mode)

## Startup Commands

### Development
```bash
# Mac/Linux
./start.sh

# Windows
start.bat
```

### Stop
```bash
# Mac/Linux
./stop.sh

# Windows
stop.bat
```

### Install Dependencies
```bash
# Python
pip install -r requirements.txt

# Backend
cd backend-node && npm install

# Frontend
cd frontend && npm install
```

## File Naming Conventions
- Components: PascalCase (Dashboard.js, Login.js)
- Services: camelCase (authService.js, api.js)
- Utils: camelCase (formatDate.js)
- CSS: kebab-case (not used, using Tailwind)
- Environment: .env

## Git Workflow
- Main branch: Production-ready code
- Feature branches: feature/name
- Commit messages: Clear, descriptive
- Never commit .env file
- Never commit node_modules/
- Never commit venv/

## Security Best Practices
- Never expose JWT_SECRET
- Use bcrypt for password hashing (12 rounds)
- Validate all user inputs
- Sanitize data before database queries
- Use HTTPS in production
- Set secure CORS origins in production
- Implement rate limiting (production)

## Known Limitations
- Models trained on historical data (2015-2024)
- Best for medium-term predictions (3-12 months)
- Average accuracy: 75-85%
- Educational/backtesting only, not financial advice

## Troubleshooting

### Port Already in Use
```bash
lsof -ti:5001 | xargs kill -9
lsof -ti:3000 | xargs kill -9
```

### Models Not Loading
- Check models/ folder has 10 .keras files
- Run: python3 model.py to retrain

### MongoDB Connection Failed
- Works without MongoDB (demo mode)
- Check MONGODB_URI in .env
- Verify MongoDB Atlas IP whitelist

### Frontend Not Loading
- Check npm install completed
- Clear browser cache
- Check console for errors

## When Modifying Code

### Always Consider:
1. Does it break the 4-step flow?
2. Does it work without MongoDB?
3. Are animations smooth?
4. Is date format YYYY-MM-DD?
5. Are error messages clear?
6. Is loading state shown?
7. Is it mobile responsive?
8. Does it follow the color scheme?

### Never:
- Remove MongoDB fallback logic
- Break the step-by-step flow
- Use custom CSS (use Tailwind)
- Hardcode values (use .env)
- Commit sensitive data
- Remove error handling
- Block the UI without loading state

## Contact & Support
- Check README.md for setup
- Review this file for guidelines
- Test thoroughly before deploying
- Document new features

---

Last Updated: November 2025

